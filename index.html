<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat to WhatsApp Without Saving Numbers | WA Direct Link</title>
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/wa-icon-192.png"> 
    <meta name="theme-color" content="#25D366"/>

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #f7f7f7;
        }
        .card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="p-4 flex items-center justify-center min-h-screen">

    <div class="card w-full max-w-md bg-white rounded-xl p-6 md:p-8">
        <h1 class="text-2xl font-bold text-gray-800 mb-4 text-center">Chat to Whatsapp without saving numbers ðŸš€</h1>
        <p class="text-sm text-gray-500 mb-6 text-center">Just input the number in the field below and press "Open Whatsapp Link".</p>

        <div class="mb-4">
            <label for="phoneNumber" class="block text-sm font-medium text-gray-700">WhatsApp Number (Example: 081234567890)</label>
            <input type="tel" id="phoneNumber" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500" placeholder="0812xxxxxxx" required>
            
            <p id="nonNumericError" class="text-red-500 text-xs mt-1 hidden">Non-numerical input detected.</p>
            
            <p id="errorMsg" class="text-red-500 text-xs mt-1 hidden">Invalid format. Please start with **08** and use 8-15 digits.</p>
        </div>
        
        <div class="space-y-4">
            <button id="openChatBtn" class="w-full flex items-center justify-center px-4 py-2 border border-transparent text-base font-medium rounded-lg shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150">
                Open Whatsapp Link ðŸ’¬
            </button>
            <button id="copyLinkBtn" class="w-full flex items-center justify-center px-4 py-2 border border-green-600 text-base font-medium rounded-lg text-green-600 bg-white hover:bg-green-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition duration-150">
                Copy Link ðŸ”—
            </button>
            <p id="successMsg" class="text-center text-sm text-green-600 hidden">Link copied successfully!</p>
        </div>

    </div>

    <script>
        const phoneInput = document.getElementById('phoneNumber');
        const openChatBtn = document.getElementById('openChatBtn');
        const copyLinkBtn = document.getElementById('copyLinkBtn');
        const errorMsg = document.getElementById('errorMsg'); // Format/length error
        const nonNumericError = document.getElementById('nonNumericError'); // New non-numeric error
        const successMsg = document.getElementById('successMsg');
        
        const WA_BASE_URL = 'https://wa.me/';

        function formatNumber(localNumber) {
            // Remove all non-digit characters
            let cleanNumber = localNumber.replace(/\D/g, ''); 
            
            if (cleanNumber.startsWith('08')) {
                // Replace '0' with '62' (for Indonesian country code)
                return '62' + cleanNumber.substring(1);
            }
            return cleanNumber;
        }

        function setInputError(isError, errorElement) {
            if (isError) {
                errorElement.classList.remove('hidden');
                phoneInput.classList.add('border-red-500'); 
                phoneInput.classList.remove('focus:ring-green-500', 'focus:border-green-500');
                // Disable buttons when invalid input is present
                openChatBtn.disabled = true;
                copyLinkBtn.disabled = true;
            } else {
                errorElement.classList.add('hidden');
                phoneInput.classList.remove('border-red-500');
                phoneInput.classList.add('focus:ring-green-500', 'focus:border-green-500');
                openChatBtn.disabled = false;
                copyLinkBtn.disabled = false;
            }
        }
        
        // --- Core Link Generation and Validation ---
        function generateLink() {
            const inputVal = phoneInput.value;
            const formattedNum = formatNumber(inputVal);

            // Check for non-numeric input first (but allow + sign for other countries if needed)
            const isNonNumeric = /[^0-9]/.test(inputVal.replace(/^\+/, ''));
            if (isNonNumeric) {
                // If non-numeric input is detected, show that specific error and stop.
                setInputError(true, nonNumericError);
                return null;
            } else {
                setInputError(false, nonNumericError);
            }
            
            // Validation: Ensure it starts with 08 and results in a valid length
            const isValidFormat = inputVal.startsWith('08') && formattedNum.length >= 11 && formattedNum.length <= 18; 
            
            if (!isValidFormat) {
                // If format is invalid (not 08 or wrong length), show that error and stop.
                setInputError(true, errorMsg);
                return null;
            }
            
            // Success state
            setInputError(false, errorMsg);
            return WA_BASE_URL + formattedNum;
        }

        // --- Event Listeners ---
        
        // Real-time check for non-numerical characters
        phoneInput.addEventListener('input', () => {
            // Check for non-numerical input in real-time
            const isNonNumeric = /[^0-9]/.test(phoneInput.value);
            
            if (isNonNumeric) {
                setInputError(true, nonNumericError);
            } else {
                // If input is clean, re-enable buttons and hide non-numeric error
                setInputError(false, nonNumericError);
                
                // Also hide other errors until button is pressed
                errorMsg.classList.add('hidden'); 
                successMsg.classList.add('hidden'); 
                phoneInput.classList.remove('border-red-500');
                phoneInput.classList.add('focus:ring-green-500', 'focus:border-green-500');
            }
        });


        // Auto-clean input when the user leaves the field
        phoneInput.addEventListener('blur', () => {
            // Strip any remaining non-digits
            phoneInput.value = phoneInput.value.replace(/[^0-9]/g, '');
            // Re-validate to ensure clean state
            generateLink(); 
        });

        // 1. Open Chat Button Handler
        openChatBtn.addEventListener('click', () => {
            successMsg.classList.add('hidden');
            const waLink = generateLink();
            if (waLink) {
                window.open(waLink, '_blank'); 
            }
        });

        // 2. Copy Link Button Handler
        copyLinkBtn.addEventListener('click', () => {
            const waLink = generateLink();
            if (waLink) {
                navigator.clipboard.writeText(waLink).then(() => {
                    successMsg.textContent = 'Link copied successfully: ' + waLink;
                    successMsg.classList.remove('hidden');
                    setTimeout(() => successMsg.classList.add('hidden'), 3000); 
                }).catch(err => {
                    console.error('Could not copy text: ', err);
                    alert('Failed to copy link. Please try manually.');
                });
            }
        });

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed: ', error);
                    });
            });
        }
    </script>
</body>
</html>
